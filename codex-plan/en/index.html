<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Planning with Codex in Claude Code</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; }
    .fade-in { animation: fadeInUp 0.6s ease-out; }
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    pre { font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace; }
    .code-block::-webkit-scrollbar { height: 8px; }
    .code-block::-webkit-scrollbar-thumb { background: #64748B; border-radius: 4px; }
  </style>
</head>
<body class="bg-[#FAFAFA] text-[#1E293B]">

  <!-- Language Switcher -->
  <div id="lang-switcher" class="fixed top-4 right-4 z-50">
    <button id="lang-btn" class="flex items-center gap-2 bg-white/90 backdrop-blur-sm px-3 py-2 rounded-full shadow-md border border-gray-200 text-[14px] font-medium text-gray-700 hover:bg-white hover:shadow-lg transition-all duration-200">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9"/></svg>
      <span id="current-lang">English</span>
      <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
    </button>
    <div id="lang-menu" class="hidden absolute right-0 mt-2 bg-white rounded-xl shadow-xl border border-gray-200 overflow-hidden min-w-[140px]">
      <a href="../index.html" class="flex items-center gap-2 px-4 py-2.5 text-[14px] text-gray-700 hover:bg-indigo-50 hover:text-indigo-600 transition-colors">
        <span class="w-5">üáπüáº</span>Ê≠£È´î‰∏≠Êñá
      </a>
      <a href="./index.html" class="flex items-center gap-2 px-4 py-2.5 text-[14px] text-gray-700 hover:bg-indigo-50 hover:text-indigo-600 transition-colors bg-indigo-50 text-indigo-600">
        <span class="w-5">üá∫üá∏</span>English
      </a>
      <a href="../jp/index.html" class="flex items-center gap-2 px-4 py-2.5 text-[14px] text-gray-700 hover:bg-indigo-50 hover:text-indigo-600 transition-colors">
        <span class="w-5">üáØüáµ</span>Êó•Êú¨Ë™û
      </a>
    </div>
  </div>

  <!-- Hero Section -->
  <header class="bg-gradient-to-br from-blue-600 via-indigo-600 to-purple-700 text-white py-16 md:py-20 overflow-hidden">
    <div class="max-w-7xl mx-auto px-6">
      <div class="grid lg:grid-cols-5 gap-10 lg:gap-12 items-center">
        <!-- Left: Text content (2 columns) -->
        <div class="fade-in lg:col-span-2">
          <p class="text-[18px] md:text-[20px] text-blue-200 mb-4 font-medium tracking-wide">Claude Code √ó Codex CLI</p>
          <h1 class="text-[36px] md:text-[44px] lg:text-[52px] font-extrabold leading-[1.1] mb-6">
            Don't Let One AI Do Everything
          </h1>
          <p class="text-[18px] md:text-[20px] leading-relaxed text-blue-100 mb-6">
            Use <code class="bg-white/20 px-2 py-1 rounded-lg">/codex-plan</code> to split work between two AIs: Claude asks questions, Codex writes the plan. Each plays to its strengths for better output.
          </p>
          <div class="flex flex-wrap items-center gap-3 text-[16px] text-blue-200">
            <span>Original source:</span>
            <a href="https://x.com/LLMJunky" target="_blank" rel="noopener" class="inline-flex items-center gap-2 bg-white/10 hover:bg-white/20 px-4 py-2 rounded-full transition-all duration-200">
              <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
              <span class="font-medium">@LLMJunky</span>
            </a>
            <a href="https://x.com/LLMJunky/status/2013155739632549995" target="_blank" rel="noopener" class="inline-flex items-center gap-2 bg-white/10 hover:bg-white/20 px-4 py-2 rounded-full transition-all duration-200">
              <span>Original post ‚Üí</span>
            </a>
          </div>
          <p class="mt-5 text-[15px] md:text-[16px] text-blue-200/70 leading-relaxed">
            The source code in this article comes from the original post, with added deployment instructions. Copy directly to .claude/commands/ to use.
          </p>
        </div>

        <!-- Right: Cover image (3 columns, overflows right) -->
        <div class="fade-in lg:col-span-3 relative lg:-mr-16 xl:-mr-24">
          <div class="relative">
            <!-- Decorative glow -->
            <div class="absolute -inset-6 bg-gradient-to-r from-blue-400/30 to-purple-400/30 rounded-3xl blur-3xl"></div>
            <!-- Cover image -->
            <img
              src="./cover-image/ai-agent-division/cover.png"
              alt="AI Agent Division of Labor: Claude and Codex collaboration diagram"
              class="relative w-full rounded-2xl shadow-2xl ring-1 ring-white/20 transform hover:scale-[1.01] transition-transform duration-500"
            >
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Pain Point Section -->
  <section class="bg-gray-900 text-white py-16 md:py-20">
    <div class="max-w-6xl mx-auto px-6">
      <h2 class="text-[28px] md:text-[36px] font-bold mb-8 text-red-400">Problem: Planning Phase Burns Your Tokens and Time</h2>

      <!-- Illustration: Four pain points -->
      <figure class="mb-10">
        <img
          src="./illustrations/codex-plan-guide/illustration-pain-points.png"
          alt="Four pain points: Opus is expensive, poor planning leads to bugs, tool-switching is annoying, inconsistent prompt quality"
          class="w-full max-w-3xl mx-auto rounded-2xl shadow-2xl ring-1 ring-white/10"
          loading="lazy"
        >
      </figure>

      <div class="grid md:grid-cols-2 gap-8">
        <div class="space-y-6">
          <div class="flex gap-4">
            <span class="text-[28px]">üî•</span>
            <div>
              <h3 class="text-[22px] font-semibold mb-2">Opus is Expensive, Wasteful for Planning</h3>
              <p class="text-[20px] text-gray-400 leading-relaxed">Planning requires heavy reasoning. Every time Opus thinks through architecture, tokens burn fast.</p>
            </div>
          </div>
          <div class="flex gap-4">
            <span class="text-[28px]">üêõ</span>
            <div>
              <h3 class="text-[22px] font-semibold mb-2">Poor Planning = Bugs Later</h3>
              <p class="text-[20px] text-gray-400 leading-relaxed">Jump straight into coding: messy architecture, unclear dependencies, hard to maintain. Save planning time, pay double in debugging.</p>
            </div>
          </div>
        </div>
        <div class="space-y-6">
          <div class="flex gap-4">
            <span class="text-[28px]">üîÄ</span>
            <div>
              <h3 class="text-[22px] font-semibold mb-2">Tool-Switching is Annoying</h3>
              <p class="text-[20px] text-gray-400 leading-relaxed">Plan in ChatGPT, copy to Claude Code for implementation, paste back and forth, context breaks.</p>
            </div>
          </div>
          <div class="flex gap-4">
            <span class="text-[28px]">‚ùì</span>
            <div>
              <h3 class="text-[22px] font-semibold mb-2">Inconsistent Prompt Quality</h3>
              <p class="text-[20px] text-gray-400 leading-relaxed">Self-written planning prompts often miss things. Codex gets vague instructions, produces vague output.</p>
            </div>
          </div>
        </div>
      </div>

      <div class="mt-12 p-6 bg-gradient-to-r from-green-900/50 to-emerald-900/50 rounded-2xl border border-green-700/50">
        <p class="text-[20px] md:text-[22px] leading-relaxed">
          <span class="text-green-400 font-semibold">Solution:</span>
          Use GPT-5.2 Codex's xhigh reasoning for planning‚Äîfewer bugs, more maintainable code, cleaner implementations. Let the strongest reasoner plan, let the best coder implement. Play to their strengths.
        </p>
      </div>
    </div>
  </section>

  <main class="max-w-6xl mx-auto px-6">

    <!-- What is /codex-plan -->
    <section class="py-16 md:py-24">
      <h2 class="text-[32px] md:text-[40px] font-bold mb-8">What is /codex-plan?</h2>

      <!-- Illustration: Claude √ó Codex collaboration workflow -->
      <figure class="mb-10">
        <img
          src="./illustrations/codex-plan-guide/illustration-workflow.png"
          alt="Claude √ó Codex collaboration workflow: Claude asks questions to gather requirements, Codex deep reasoning produces plans"
          class="w-full max-w-4xl mx-auto rounded-2xl shadow-lg"
          loading="lazy"
        >
      </figure>

      <div class="bg-white rounded-2xl shadow-md p-6 md:p-8 space-y-6">
        <p class="text-[20px] leading-relaxed">
          <code class="bg-gray-100 text-indigo-600 px-2 py-1 rounded-lg font-medium">/codex-plan</code> is a Claude Code Slash Command. It lets you invoke OpenAI's Codex CLI directly from the terminal, producing detailed implementation plans with dependency tracking.
        </p>
        <div class="grid md:grid-cols-3 gap-6">
          <div class="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-6 border border-blue-100">
            <div class="text-[32px] mb-3">üí¨</div>
            <h3 class="text-[24px] font-semibold mb-2">Claude Asks Questions</h3>
            <p class="text-[20px] text-[#64748B]">Uses AskUser to clarify requirements and gather context</p>
          </div>
          <div class="bg-gradient-to-br from-purple-50 to-pink-50 rounded-xl p-6 border border-purple-100">
            <div class="text-[32px] mb-3">üß†</div>
            <h3 class="text-[24px] font-semibold mb-2">Codex Deep Reasoning</h3>
            <p class="text-[20px] text-[#64748B]">Uses xhigh reasoning to produce structured plans</p>
          </div>
          <div class="bg-gradient-to-br from-green-50 to-emerald-50 rounded-xl p-6 border border-green-100">
            <div class="text-[32px] mb-3">üìã</div>
            <h3 class="text-[24px] font-semibold mb-2">Outputs Work Breakdown</h3>
            <p class="text-[20px] text-[#64748B]">Tags dependencies, enables parallel execution</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Benefits Grid -->
    <section class="py-16 md:py-24 border-t border-[#E2E8F0]">
      <h2 class="text-[32px] md:text-[40px] font-bold mb-8">Why This Approach?</h2>

      <!-- Illustration: Six benefits -->
      <figure class="mb-12">
        <img
          src="./illustrations/codex-plan-guide/illustration-benefits.png"
          alt="Six benefits: Interaction handled by Claude, token cost shifted, no context switching, parallel execution with dependencies, higher prompt quality, workflow packaged into one command"
          class="w-full max-w-4xl mx-auto rounded-2xl shadow-lg"
          loading="lazy"
        >
      </figure>

      <div class="grid md:grid-cols-2 gap-8">

        <article class="bg-white rounded-2xl shadow-md p-6 md:p-8 transition-all duration-300 hover:-translate-y-1 hover:shadow-xl">
          <div class="text-[36px] mb-4">üéØ</div>
          <h3 class="text-[24px] font-semibold mb-3">Interaction Handled by Claude</h3>
          <p class="text-[20px] text-[#64748B] leading-relaxed">
            Claude Code's <code class="bg-gray-100 px-1.5 py-0.5 rounded text-[18px]">AskUser</code> is smoother than Codex CLI's interaction mechanism. Conversation stays conversation, computation stays computation.
          </p>
        </article>

        <article class="bg-white rounded-2xl shadow-md p-6 md:p-8 transition-all duration-300 hover:-translate-y-1 hover:shadow-xl">
          <div class="text-[36px] mb-4">üí∞</div>
          <h3 class="text-[24px] font-semibold mb-3">Token Cost Shifted</h3>
          <p class="text-[20px] text-[#64748B] leading-relaxed">
            Opus is expensive. Let Codex handle planning with xhigh reasoning. OpenAI subscription does the heavy lifting, Anthropic quota saved for implementation.
          </p>
        </article>

        <article class="bg-white rounded-2xl shadow-md p-6 md:p-8 transition-all duration-300 hover:-translate-y-1 hover:shadow-xl">
          <div class="text-[36px] mb-4">‚ö°</div>
          <h3 class="text-[24px] font-semibold mb-3">No Context Switching</h3>
          <p class="text-[20px] text-[#64748B] leading-relaxed">
            Everything in terminal: input command, answer questions, wait for results, start coding. No browser, no window switching.
          </p>
        </article>

        <article class="bg-white rounded-2xl shadow-md p-6 md:p-8 transition-all duration-300 hover:-translate-y-1 hover:shadow-xl">
          <div class="text-[36px] mb-4">üîÄ</div>
          <h3 class="text-[24px] font-semibold mb-3">Parallel Execution with Dependencies</h3>
          <p class="text-[20px] text-[#64748B] leading-relaxed">
            Each Task tags Dependencies. Tasks without dependencies can run in multiple instances simultaneously. This is a work distribution table.
          </p>
        </article>

        <article class="bg-white rounded-2xl shadow-md p-6 md:p-8 transition-all duration-300 hover:-translate-y-1 hover:shadow-xl">
          <div class="text-[36px] mb-4">‚ú®</div>
          <h3 class="text-[24px] font-semibold mb-3">Higher Prompt Quality</h3>
          <p class="text-[20px] text-[#64748B] leading-relaxed">
            User-written prompts are often vague. Claude asks first, organizes, then feeds to Codex. Extra filtering layer in between, more precise output.
          </p>
        </article>

        <article class="bg-white rounded-2xl shadow-md p-6 md:p-8 transition-all duration-300 hover:-translate-y-1 hover:shadow-xl">
          <div class="text-[36px] mb-4">üì¶</div>
          <h3 class="text-[24px] font-semibold mb-3">Workflow Packaged into One Command</h3>
          <p class="text-[20px] text-[#64748B] leading-relaxed">
            No need to remember Codex CLI parameters, no manual prompt assembly. Slash command has it packaged. Reuse cost approaches zero.
          </p>
        </article>

      </div>
    </section>

    <!-- How to Use -->
    <section class="py-16 md:py-24 border-t border-[#E2E8F0]">
      <h2 class="text-[32px] md:text-[40px] font-bold mb-8">How to Use</h2>

      <!-- Illustration: Three-step setup process -->
      <figure class="mb-10">
        <img
          src="./illustrations/codex-plan-guide/illustration-setup-steps.png"
          alt="Three-step setup process: Install Codex CLI, create Slash Command file, execute command"
          class="w-full max-w-4xl mx-auto rounded-2xl shadow-lg"
          loading="lazy"
        >
      </figure>

      <div class="space-y-6">
        <div class="bg-white rounded-2xl shadow-md p-6 md:p-8">
          <h3 class="text-[24px] font-semibold mb-4">1. Install Codex CLI</h3>
          <pre class="bg-gray-900 text-gray-100 rounded-xl p-4 overflow-x-auto code-block text-[18px]"><code>npm install -g @openai/codex
export OPENAI_API_KEY="sk-..."</code></pre>
        </div>

        <div class="bg-white rounded-2xl shadow-md p-6 md:p-8">
          <h3 class="text-[24px] font-semibold mb-4">2. Create Slash Command File</h3>
          <p class="text-[20px] text-[#64748B] mb-4">Place in project or global directory:</p>
          <pre class="bg-gray-900 text-gray-100 rounded-xl p-4 overflow-x-auto code-block text-[18px]"><code># Project level
.claude/commands/codex-plan.md

# Global level
~/.claude/commands/codex-plan.md</code></pre>
        </div>

        <div class="bg-white rounded-2xl shadow-md p-6 md:p-8">
          <h3 class="text-[24px] font-semibold mb-4">3. Execute</h3>
          <pre class="bg-gray-900 text-gray-100 rounded-xl p-4 overflow-x-auto code-block text-[18px]"><code>/codex-plan implement user authentication system</code></pre>
        </div>
      </div>
    </section>

    <!-- What is Claude Code Commands -->
    <section class="py-16 md:py-24 border-t border-[#E2E8F0]">
      <h2 class="text-[32px] md:text-[40px] font-bold mb-8">What is .claude/commands?</h2>

      <!-- Illustration: Commands six features -->
      <figure class="mb-10">
        <img
          src="./illustrations/codex-plan-guide/illustration-commands-features.png"
          alt="Commands six features: Package complex workflows, specify available tools, accept arguments, invoke external CLIs, interactive Q&A, read/write files"
          class="w-full max-w-4xl mx-auto rounded-2xl shadow-lg"
          loading="lazy"
        >
      </figure>

      <div class="bg-white rounded-2xl shadow-md p-6 md:p-8">
        <p class="text-[20px] leading-relaxed mb-6">
          <code class="bg-gray-100 text-indigo-600 px-2 py-1 rounded-lg">.claude/commands/</code> is Claude Code's custom command directory. <code class="bg-gray-100 px-2 py-1 rounded-lg">.md</code> files placed here become executable Slash Commands.
        </p>

        <div class="grid md:grid-cols-2 gap-6 mb-8">
          <div class="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-6 border border-blue-100">
            <h3 class="text-[22px] font-semibold mb-3">üìÅ Storage Locations</h3>
            <ul class="text-[20px] text-[#64748B] space-y-2">
              <li><code class="bg-white px-2 py-0.5 rounded text-[18px]">.claude/commands/</code> ‚Äî Project level, only works in that project</li>
              <li><code class="bg-white px-2 py-0.5 rounded text-[18px]">~/.claude/commands/</code> ‚Äî Global level, works in all projects</li>
            </ul>
          </div>
          <div class="bg-gradient-to-br from-purple-50 to-pink-50 rounded-xl p-6 border border-purple-100">
            <h3 class="text-[22px] font-semibold mb-3">‚ö° Trigger Method</h3>
            <p class="text-[20px] text-[#64748B]">
              Filename becomes command name.<br>
              <code class="bg-white px-2 py-0.5 rounded text-[18px]">codex-plan.md</code> ‚Üí <code class="bg-white px-2 py-0.5 rounded text-[18px]">/codex-plan</code>
            </p>
          </div>
        </div>

        <h3 class="text-[22px] font-semibold mb-4">What Can Commands Do?</h3>
        <div class="grid md:grid-cols-3 gap-4">
          <div class="bg-gray-50 rounded-xl p-5 border border-gray-200">
            <div class="text-[28px] mb-2">üîß</div>
            <h4 class="text-[20px] font-semibold mb-2">Package Complex Workflows</h4>
            <p class="text-[18px] text-[#64748B]">Wrap multi-step work into one command for reuse</p>
          </div>
          <div class="bg-gray-50 rounded-xl p-5 border border-gray-200">
            <div class="text-[28px] mb-2">üõ†Ô∏è</div>
            <h4 class="text-[20px] font-semibold mb-2">Specify Available Tools</h4>
            <p class="text-[18px] text-[#64748B]">Use <code class="bg-white px-1 rounded">allowed-tools</code> to limit tools Claude can use</p>
          </div>
          <div class="bg-gray-50 rounded-xl p-5 border border-gray-200">
            <div class="text-[28px] mb-2">üí¨</div>
            <h4 class="text-[20px] font-semibold mb-2">Accept Arguments</h4>
            <p class="text-[18px] text-[#64748B]"><code class="bg-white px-1 rounded">$ARGUMENTS</code> receives user input</p>
          </div>
          <div class="bg-gray-50 rounded-xl p-5 border border-gray-200">
            <div class="text-[28px] mb-2">ü§ñ</div>
            <h4 class="text-[20px] font-semibold mb-2">Invoke External CLIs</h4>
            <p class="text-[18px] text-[#64748B]">Execute any command-line tool via Bash</p>
          </div>
          <div class="bg-gray-50 rounded-xl p-5 border border-gray-200">
            <div class="text-[28px] mb-2">‚ùì</div>
            <h4 class="text-[20px] font-semibold mb-2">Interactive Q&A</h4>
            <p class="text-[18px] text-[#64748B]">Use <code class="bg-white px-1 rounded">AskUser</code> to collect more information</p>
          </div>
          <div class="bg-gray-50 rounded-xl p-5 border border-gray-200">
            <div class="text-[28px] mb-2">üìù</div>
            <h4 class="text-[20px] font-semibold mb-2">Read/Write Files</h4>
            <p class="text-[18px] text-[#64748B]">Auto-generate docs, code, plans</p>
          </div>
        </div>

        <div class="mt-8 p-5 bg-amber-50 rounded-xl border border-amber-200">
          <p class="text-[20px] text-amber-800">
            <span class="font-semibold">üí° Essence:</span>
            Commands are System Prompts for Claude. You're defining Claude's behavior mode, available tools, and output format for this command.
          </p>
        </div>
      </div>
    </section>

    <!-- Code Block -->
    <section class="py-16 md:py-24 border-t border-[#E2E8F0]">
      <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-8">
        <h2 class="text-[32px] md:text-[40px] font-bold">Complete codex-plan.md</h2>
        <button id="copyBtn" onclick="copyCode()" class="mt-4 md:mt-0 relative inline-flex items-center gap-2 bg-gradient-to-r from-blue-500 to-indigo-600 text-white px-6 py-3 rounded-xl font-semibold text-[20px] transition-all duration-200 hover:scale-[1.02] hover:shadow-lg active:scale-[0.98] overflow-hidden">
          <span id="copyIcon" class="transition-all duration-300">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
              <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
              <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
            </svg>
          </span>
          <span id="copyText">Copy Code</span>
          <span id="copySuccess" class="absolute inset-0 flex items-center justify-center gap-2 bg-gradient-to-r from-green-500 to-emerald-600 opacity-0 transition-all duration-300 pointer-events-none">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
            </svg>
            Copied to clipboard!
          </span>
        </button>
      </div>
      <div class="bg-gray-900 rounded-2xl shadow-xl overflow-hidden">
        <div class="flex items-center gap-2 px-4 py-3 bg-gray-800 border-b border-gray-700">
          <div class="w-3 h-3 rounded-full bg-red-500"></div>
          <div class="w-3 h-3 rounded-full bg-yellow-500"></div>
          <div class="w-3 h-3 rounded-full bg-green-500"></div>
          <span class="ml-3 text-gray-400 text-[16px]">codex-plan.md</span>
        </div>
        <pre id="codeBlock" class="text-gray-100 p-6 overflow-x-auto code-block text-[16px] leading-relaxed max-h-[600px] overflow-y-auto"><code>---
description: Create a detailed implementation plan using Codex with xhigh reasoning
argument-hint: "&lt;what you want to plan&gt;"
allowed-tools: Read, Write, Bash, AskUser
---

# Codex Plan Command

You are being asked to create a detailed implementation plan using a Codex subagent. Your job is to:
1. Understand the user's planning request
2. Ask clarifying questions using AskUser to improve plan quality
3. Craft an excellent, detailed prompt for Codex
4. Execute Codex to generate and save the plan

**Always uses:** `gpt-5.2-codex` with `xhigh` reasoning

## User Request

```
$ARGUMENTS
```

## Step 1: Analyze the Request

Look at what the user wants to plan. Identify:
- What is the core goal?
- What technology/domain is involved?
- What aspects are ambiguous or underspecified?
- What decisions would significantly impact the plan?

## Step 2: Ask Clarifying Questions

**Use AskUser to ask 3-6 targeted clarifying questions** before generating the plan.

Good clarifying questions:
- Narrow down scope and requirements
- Clarify technology choices
- Understand constraints (time, budget, team size)
- Identify must-haves vs nice-to-haves
- Uncover integration requirements
- Determine security/compliance needs

### Example Question Patterns

**For "implement auth":**
- What authentication methods do you need? (email/password, OAuth providers like Google/GitHub, SSO, magic links)
- Do you need role-based access control (RBAC) or just authenticated/unauthenticated?
- What's your backend stack? (Node/Express, Python/Django, etc.)
- Where will you store user credentials/sessions? (Database, Redis, JWT stateless)
- Do you need features like: password reset, email verification, 2FA?
- Any compliance requirements? (SOC2, GDPR, HIPAA)

**For "build an API":**
- What resources/entities does this API need to manage?
- REST or GraphQL?
- What authentication will the API use?
- Expected scale/traffic?
- Do you need rate limiting, caching, versioning?

**For "migrate to microservices":**
- Which parts of the monolith are you migrating first?
- What's your deployment target? (K8s, ECS, etc.)
- How will services communicate? (REST, gRPC, message queues)
- What's your timeline and team capacity?

**For "add testing":**
- What testing levels do you need? (unit, integration, e2e)
- What's your current test coverage?
- What frameworks do you prefer or already use?
- What's the most critical functionality to test first?

## Step 3: Gather Context

After getting answers, also gather relevant context:
- Read key files in the codebase if applicable
- Check existing architecture/patterns
- Note any existing plans or documentation

## Step 4: Craft the Codex Prompt

Create a detailed prompt that includes:
1. **Clear objective** - What plan needs to be created
2. **All requirements** - Everything learned from clarifying questions
3. **Constraints** - Technology choices, timeline, team size
4. **Context** - Relevant codebase info, existing patterns
5. **Plan structure** - What sections the plan should include
6. **Output instructions** - Write to `codex-plan.md` in current directory

**Critical instruction to include:** Tell Codex to NOT ask any further clarifying questions - it has all the information it needs and should just write the plan and save the file.

## Step 5: Execute Codex

```bash
codex exec --full-auto --skip-git-repo-check \
  -c model=gpt-5.2-codex \
  -c model_reasoning_effort=xhigh \
  --output-last-message /tmp/codex-plan-result.txt \
  "YOUR_CRAFTED_PROMPT_HERE"
```

Then show the results:
```bash
cat /tmp/codex-plan-result.txt
```

## Plan Output Structure

The generated plan should follow this template:

```markdown
# Plan: [Task Name]

**Generated**: [Date]
**Estimated Complexity**: [Low/Medium/High]

## Overview
[Brief summary of what needs to be done and the general approach, including recommended libraries/tools]

## Prerequisites
- [Dependencies or requirements that must be met first]
- [Tools, libraries, or access needed]

## Phase 1: [Phase Name]
**Goal**: [What this phase accomplishes]

### Task 1.1: [Task Name]
- **Location**: [File paths or components involved]
- **Description**: [What needs to be done]
- **Dependencies**: [Task IDs this depends on, e.g., "None" or "1.2, 2.1"]
- **Complexity**: [1-10]
- **Test-First Approach**:
  - [Test to write before implementation]
  - [What the test should verify]
- **Acceptance Criteria**:
  - [Specific, testable criteria]

### Task 1.2: [Task Name]
[Same structure...]

## Phase 2: [Phase Name]
[...]

## Testing Strategy
- **Unit Tests**: [What to unit test, frameworks to use]
- **Integration Tests**: [API/service integration tests]
- **E2E Tests**: [Critical user flows to test end-to-end]
- **Test Coverage Goals**: [Target coverage percentage]

## Dependency Graph
[Show which tasks can run in parallel vs which must be sequential]
- Tasks with no dependencies: [list - these can start immediately]
- Task dependency chains: [show critical path]

## Potential Risks
- [Things that could go wrong]
- [Mitigation strategies]

## Rollback Plan
- [How to undo changes if needed]
```

### Task Guidelines
Each task must:
- Be specific and actionable (not vague)
- Have clear inputs and outputs
- Be independently testable
- Include file paths and specific code locations
- Include dependencies so parallel execution is possible
- Include complexity score (1-10)

Break large tasks into smaller ones:
- ‚úó Bad: "Implement Google OAuth"
- ‚úì Good:
  - "Add Google OAuth config to environment variables"
  - "Install and configure passport-google-oauth20 package"
  - "Create OAuth callback route handler in src/routes/auth.ts"
  - "Add Google sign-in button to login UI"
  - "Write integration tests for OAuth flow"

## Important Notes

- **Always ask clarifying questions first** - Don't skip this step
- **Use AskUser tool** - This is interactive planning
- **Tell Codex not to ask questions** - It should just execute
- **Output file:** `codex-plan.md` in current working directory
- **Use --full-auto** for autonomous execution

Now analyze the user's planning request above, ask your clarifying questions, and then generate and execute the Codex plan.</code></pre>
      </div>
    </section>

    <!-- Annotated Version -->
    <section class="py-16 md:py-24 border-t border-[#E2E8F0]">
      <h2 class="text-[32px] md:text-[40px] font-bold mb-4">Line-by-Line Explanation: Why Write It This Way?</h2>
      <p class="text-[20px] text-[#64748B] mb-8">Understand the design intent of each section so you can customize it.</p>

      <div class="space-y-6">
        <!-- Frontmatter -->
        <div class="bg-white rounded-2xl shadow-md overflow-hidden">
          <div class="bg-indigo-600 text-white px-6 py-3">
            <h3 class="text-[20px] font-semibold">Frontmatter (YAML Configuration)</h3>
          </div>
          <div class="p-6">
            <pre class="bg-gray-900 text-gray-100 rounded-xl p-4 overflow-x-auto text-[15px] leading-relaxed mb-4"><code>---
description: Create a detailed implementation plan using Codex with xhigh reasoning
argument-hint: "&lt;what you want to plan&gt;"
allowed-tools: Read, Write, Bash, AskUser
---</code></pre>
            <div class="space-y-4 text-[20px]">
              <div class="flex gap-3">
                <span class="text-indigo-600 font-mono font-semibold shrink-0">description</span>
                <span class="text-[#64748B]">‚Äî Command description, shows in Claude Code's command list, helps you remember what this command does</span>
              </div>
              <div class="flex gap-3">
                <span class="text-indigo-600 font-mono font-semibold shrink-0">argument-hint</span>
                <span class="text-[#64748B]">‚Äî Parameter hint, tells users what to input. E.g., <code class="bg-gray-100 px-1.5 rounded">/codex-plan implement auth system</code></span>
              </div>
              <div class="flex gap-3">
                <span class="text-indigo-600 font-mono font-semibold shrink-0">allowed-tools</span>
                <span class="text-[#64748B]">‚Äî Limits Claude to these four tools: read files, write files, execute Bash, ask user questions. This is a security boundary.</span>
              </div>
            </div>
          </div>
        </div>

        <!-- $ARGUMENTS -->
        <div class="bg-white rounded-2xl shadow-md overflow-hidden">
          <div class="bg-purple-600 text-white px-6 py-3">
            <h3 class="text-[20px] font-semibold">$ARGUMENTS Variable</h3>
          </div>
          <div class="p-6">
            <pre class="bg-gray-900 text-gray-100 rounded-xl p-4 overflow-x-auto text-[15px] leading-relaxed mb-4"><code>## User Request

```
$ARGUMENTS
```</code></pre>
            <p class="text-[20px] text-[#64748B]">
              <code class="bg-gray-100 text-purple-600 px-1.5 rounded">$ARGUMENTS</code> is a Claude Code built-in variable. When user inputs <code class="bg-gray-100 px-1.5 rounded">/codex-plan implement user auth</code>, the text <code class="bg-gray-100 px-1.5 rounded">implement user auth</code> automatically replaces it.
            </p>
          </div>
        </div>

        <!-- AskUser -->
        <div class="bg-white rounded-2xl shadow-md overflow-hidden">
          <div class="bg-green-600 text-white px-6 py-3">
            <h3 class="text-[20px] font-semibold">AskUser Clarifying Questions</h3>
          </div>
          <div class="p-6">
            <pre class="bg-gray-900 text-gray-100 rounded-xl p-4 overflow-x-auto text-[15px] leading-relaxed mb-4"><code>## Step 2: Ask Clarifying Questions

**Use AskUser to ask 3-6 targeted clarifying questions** before generating the plan.</code></pre>
            <div class="space-y-3 text-[20px] text-[#64748B]">
              <p><span class="font-semibold text-green-600">Why ask questions?</span> User's initial input is usually vague. "Implement auth" could be email/password, OAuth, SSO, magic links... Without clarification, Codex can only guess.</p>
              <p><span class="font-semibold text-green-600">Why use AskUser?</span> Claude Code's AskUser tool is smoother than Codex CLI's interaction, can ask multiple questions at once, supports formatted display. Hand interaction to Claude, let Codex focus on reasoning.</p>
              <p><span class="font-semibold text-green-600">Why 3-6 questions?</span> Too few won't clarify enough, too many annoys users. 3-6 is the sweet spot.</p>
            </div>
          </div>
        </div>

        <!-- Codex Exec -->
        <div class="bg-white rounded-2xl shadow-md overflow-hidden">
          <div class="bg-orange-600 text-white px-6 py-3">
            <h3 class="text-[20px] font-semibold">Execute Codex CLI</h3>
          </div>
          <div class="p-6">
            <pre class="bg-gray-900 text-gray-100 rounded-xl p-4 overflow-x-auto text-[15px] leading-relaxed mb-4"><code>codex exec --full-auto --skip-git-repo-check \
  -c model=gpt-5.2-codex \
  -c model_reasoning_effort=xhigh \
  --output-last-message /tmp/codex-plan-result.txt \
  "YOUR_CRAFTED_PROMPT_HERE"</code></pre>
            <div class="space-y-4 text-[20px]">
              <div class="flex gap-3">
                <span class="text-orange-600 font-mono font-semibold shrink-0">--full-auto</span>
                <span class="text-[#64748B]">‚Äî Full auto mode, Codex won't ask questions mid-execution, runs to completion</span>
              </div>
              <div class="flex gap-3">
                <span class="text-orange-600 font-mono font-semibold shrink-0">--skip-git-repo-check</span>
                <span class="text-[#64748B]">‚Äî Skip Git check, avoids errors in non-Git directories</span>
              </div>
              <div class="flex gap-3">
                <span class="text-orange-600 font-mono font-semibold shrink-0">model=gpt-5.2-codex</span>
                <span class="text-[#64748B]">‚Äî Specify model. GPT-5.2 Codex is currently the strongest reasoning model, specialized for code development and planning</span>
              </div>
              <div class="flex gap-3">
                <span class="text-orange-600 font-mono font-semibold shrink-0">model_reasoning_effort=xhigh</span>
                <span class="text-[#64748B]">‚Äî Highest reasoning intensity, makes model spend more time thinking, produces more complete plans</span>
              </div>
              <div class="flex gap-3">
                <span class="text-orange-600 font-mono font-semibold shrink-0">--output-last-message</span>
                <span class="text-[#64748B]">‚Äî Saves Codex's final output to file for easy reading later</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Dependencies -->
        <div class="bg-white rounded-2xl shadow-md overflow-hidden">
          <div class="bg-blue-600 text-white px-6 py-3">
            <h3 class="text-[20px] font-semibold">Dependencies Annotation</h3>
          </div>
          <div class="p-6">
            <pre class="bg-gray-900 text-gray-100 rounded-xl p-4 overflow-x-auto text-[15px] leading-relaxed mb-4"><code>### Task 1.1: [Task Name]
- **Dependencies**: [Task IDs this depends on, e.g., "None" or "1.2, 2.1"]

## Dependency Graph
- Tasks with no dependencies: [list - these can start immediately]
- Task dependency chains: [show critical path]</code></pre>
            <div class="space-y-3 text-[20px] text-[#64748B]">
              <p><span class="font-semibold text-blue-600">Why tag dependencies?</span> Knowing which tasks have no prerequisites enables running multiple Claude Code instances in parallel. This is the foundation for swarm mode.</p>
              <p><span class="font-semibold text-blue-600">What's Dependency Graph for?</span> See the critical path at a glance, know which tasks blocking would slow overall progress.</p>
            </div>
          </div>
        </div>

        <!-- Tell Codex not to ask -->
        <div class="bg-white rounded-2xl shadow-md overflow-hidden">
          <div class="bg-red-600 text-white px-6 py-3">
            <h3 class="text-[20px] font-semibold">Key Instruction: Forbid Codex from Asking Questions</h3>
          </div>
          <div class="p-6">
            <pre class="bg-gray-900 text-gray-100 rounded-xl p-4 overflow-x-auto text-[15px] leading-relaxed mb-4"><code>**Critical instruction to include:** Tell Codex to NOT ask any further clarifying questions - it has all the information it needs and should just write the plan and save the file.</code></pre>
            <p class="text-[20px] text-[#64748B]">
              <span class="font-semibold text-red-600">This line is crucial.</span> Without it, Codex might stop and ask questions, but it's invoked through CLI with no interactive interface. Add this line to force direct output, no waiting for responses.
            </p>
          </div>
        </div>

      </div>
    </section>

    <!-- Agent Orchestration -->
    <section class="py-16 md:py-24 border-t border-[#E2E8F0]">
      <div class="bg-gradient-to-br from-indigo-50 to-purple-50 rounded-2xl p-8 md:p-12 border border-indigo-100">
        <h2 class="text-[32px] md:text-[40px] font-bold mb-6">This is the Prototype of Agent Orchestration</h2>

        <!-- Illustration: Agent orchestration loop -->
        <figure class="mb-8">
          <img
            src="./illustrations/codex-plan-guide/illustration-agent-orchestration.png"
            alt="Agent orchestration loop: Claude gathers requirements ‚Üí Codex plans ‚Üí Claude implements ‚Üí Review ‚Üí Loop"
            class="w-full max-w-3xl mx-auto rounded-xl shadow-md"
            loading="lazy"
          >
        </figure>

        <p class="text-[20px] md:text-[22px] leading-relaxed text-[#64748B] mb-8">
          One Agent gathers requirements, another Agent executes specialized tasks, results returned and presented.
        </p>
        <div class="flex flex-wrap items-center gap-4 text-[20px] font-medium">
          <span class="bg-white px-4 py-2 rounded-xl shadow-sm">Claude gathers requirements</span>
          <span class="text-indigo-400">‚Üí</span>
          <span class="bg-white px-4 py-2 rounded-xl shadow-sm">Codex plans</span>
          <span class="text-indigo-400">‚Üí</span>
          <span class="bg-white px-4 py-2 rounded-xl shadow-sm">Claude implements</span>
          <span class="text-indigo-400">‚Üí</span>
          <span class="bg-white px-4 py-2 rounded-xl shadow-sm">Review</span>
          <span class="text-indigo-400">‚Üí</span>
          <span class="bg-white px-4 py-2 rounded-xl shadow-sm">Loop</span>
        </div>
        <p class="text-[20px] text-[#64748B] mt-6">
          <code class="bg-white px-2 py-1 rounded-lg text-indigo-600">/codex-plan</code> is the minimum viable version.
        </p>
      </div>
    </section>

    <!-- Conclusion -->
    <section class="py-16 md:py-24 border-t border-[#E2E8F0]">
      <div class="text-center max-w-3xl mx-auto">
        <h2 class="text-[36px] md:text-[48px] font-extrabold mb-6">
          Don't Ask Which AI is Strongest
        </h2>
        <p class="text-[24px] md:text-[28px] text-indigo-600 font-semibold">
          Ask how to make them work together.
        </p>
      </div>
    </section>

  </main>

  <!-- Footer -->
  <footer class="bg-gray-900 text-gray-400 py-12">
    <div class="max-w-6xl mx-auto px-6 text-center">
      <p class="text-[20px]">Claude Code √ó Codex CLI ‚Äî AI Agent Division of Labor</p>
    </div>
  </footer>

  <script>
    // Language menu toggle
    (function() {
      const LANG_KEY = 'codex-plan-lang-choice';
      const langBtn = document.getElementById('lang-btn');
      const langMenu = document.getElementById('lang-menu');

      langBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        langMenu.classList.toggle('hidden');
      });

      document.addEventListener('click', () => {
        langMenu.classList.add('hidden');
      });

      // Save choice when clicking a language link
      langMenu.querySelectorAll('a').forEach(link => {
        link.addEventListener('click', () => {
          const href = link.getAttribute('href');
          if (href.includes('/jp/') || href.includes('/jp/index')) {
            localStorage.setItem(LANG_KEY, 'ja');
          } else if (href.includes('/en/') || href.includes('/en/index') || href === './index.html') {
            localStorage.setItem(LANG_KEY, 'en');
          } else {
            localStorage.setItem(LANG_KEY, 'zh');
          }
        });
      });

      // Mark current language as chosen
      localStorage.setItem(LANG_KEY, 'en');
    })();

    function copyCode() {
      const codeBlock = document.getElementById('codeBlock');
      const copyBtn = document.getElementById('copyBtn');
      const copySuccess = document.getElementById('copySuccess');
      const text = codeBlock.innerText;

      navigator.clipboard.writeText(text).then(() => {
        // Show success state
        copySuccess.classList.remove('opacity-0', 'pointer-events-none');
        copySuccess.classList.add('opacity-100');
        copyBtn.classList.add('scale-[1.05]');

        // Revert after 2 seconds
        setTimeout(() => {
          copySuccess.classList.add('opacity-0', 'pointer-events-none');
          copySuccess.classList.remove('opacity-100');
          copyBtn.classList.remove('scale-[1.05]');
        }, 2000);
      }).catch(err => {
        console.error('Copy failed:', err);
        alert('Copy failed, please select and copy manually');
      });
    }
  </script>

</body>
</html>
